let b={dotSize:1,dotSizeHighlight:2,dotGap:40,polygonSides:[3,4,6],showLines:!1};const i=200,L=200,C=.3,H=200,R={light:"#cbd5e1",dark:"#475569"};let m=null,l=null,d=[],y={x:0,y:0},T={offsetX:0,offsetY:0},M=null,X=!1,v=null,k=null,p=4,g=0,S=0;function E(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s|0}let o=e>>>0;return()=>{o=o+1831565813|0;let t=o;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function I(n,e,o,t){p=n;const s=[],r=i,a=i;switch(n){case 3:F(s,e,o,r,a);break;case 4:D(s,e,o,r,a);break;case 6:N(s,e,o,r,a);break;default:D(s,e,o,r,a)}for(const u of s)u.baseX=u.x,u.baseY=u.y;return s}function F(n,e,o,t,s){const r=b.dotGap*(Math.sqrt(3)/2),a=r,u=r*(Math.sqrt(3)/2),c=Math.ceil((e+t*2)/a)+2,h=Math.ceil((o+s*2)/u)+2;g=c,S=h;for(let f=0;f<h;f++){const w=f%2===0?0:a/2;for(let x=0;x<c;x++)n.push({x:x*a+w-t,y:f*u-s,baseX:0,baseY:0,radius:b.dotSize,targetRadius:b.dotSize})}}function D(n,e,o,t,s){const r=b.dotGap*(Math.sqrt(2)/2),a=Math.ceil((e+t*2)/r)+2,u=Math.ceil((o+s*2)/r)+2;g=a,S=u;for(let c=0;c<u;c++)for(let h=0;h<a;h++)n.push({x:h*r-t,y:c*r-s,baseX:0,baseY:0,radius:b.dotSize,targetRadius:b.dotSize})}function N(n,e,o,t,s){const r=b.dotGap/2,a=r*(Math.sqrt(3)/2),u=Math.ceil((e+t*2)/(3*r))+2,c=Math.ceil((o+s*2)/a)+2;g=u*2,S=c;for(let h=0;h<c;h++){const f=h%2===0;for(let w=0;w<u;w++){const x=w*3*r,z=f?0:1.5*r;n.push({x:x+z-t,y:h*a-s,baseX:0,baseY:0,radius:b.dotSize,targetRadius:b.dotSize}),n.push({x:x+z+r-t,y:h*a-s,baseX:0,baseY:0,radius:b.dotSize,targetRadius:b.dotSize})}}}function B(n,e){if(!(!l||d.length===0)){switch(l.beginPath(),p){case 3:W(n,e);break;case 4:_(n,e);break;case 6:U(n,e);break}l.stroke()}}function W(n,e){if(l)for(let o=0;o<S;o++)for(let t=0;t<g;t++){const s=o*g+t;if(s>=d.length)continue;const r=d[s],a=r.baseX+i+n,u=r.baseY+i+e;if(t<g-1){const c=d[s+1];l.moveTo(a,u),l.lineTo(c.baseX+i+n,c.baseY+i+e)}if(o<S-1){const c=o%2===0;if(!c||t>0){const h=s+g-(c?1:0);if(h<d.length){const f=d[h];l.moveTo(a,u),l.lineTo(f.baseX+i+n,f.baseY+i+e)}}if(c||t<g-1){const h=s+g+(c?0:1);if(h<d.length){const f=d[h];l.moveTo(a,u),l.lineTo(f.baseX+i+n,f.baseY+i+e)}}}}}function _(n,e){if(l)for(let o=0;o<S;o++)for(let t=0;t<g;t++){const s=o*g+t;if(s>=d.length)continue;const r=d[s],a=r.baseX+i+n,u=r.baseY+i+e;if(t<g-1){const c=d[s+1];l.moveTo(a,u),l.lineTo(c.baseX+i+n,c.baseY+i+e)}if(o<S-1){const c=d[s+g];c&&(l.moveTo(a,u),l.lineTo(c.baseX+i+n,c.baseY+i+e))}}}function U(n,e){if(l)for(let o=0;o<S;o++)for(let t=0;t<g;t++){const s=o*g+t;if(s>=d.length)continue;const r=d[s],a=r.baseX+i+n,u=r.baseY+i+e;if(t%2===0&&t<g-1){const c=d[s+1];l.moveTo(a,u),l.lineTo(c.baseX+i+n,c.baseY+i+e)}if(o<S-1){const c=o%2===0;if(c&&t>0){const h=s+g-1;if(h<d.length){const f=d[h];l.moveTo(a,u),l.lineTo(f.baseX+i+n,f.baseY+i+e)}}else if(!c&&t<g-1){const h=s+g+1;if(h<d.length){const f=d[h];l.moveTo(a,u),l.lineTo(f.baseX+i+n,f.baseY+i+e)}}}}}function O(){return document.documentElement.classList.contains("dark")}function $(){k=new MutationObserver(n=>{for(const e of n)e.type==="attributes"&&e.attributeName==="class"&&(X=O())}),k.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}function j(n,e){return(...o)=>{v&&clearTimeout(v),v=setTimeout(()=>n(...o),e)}}function A(){if(!l||!m)return;const n=.08;T.offsetX+=(y.x-T.offsetX)*n,T.offsetY+=(y.y-T.offsetY)*n,l.clearRect(0,0,m.width,m.height),l.fillStyle=X?R.dark:R.light,l.strokeStyle=X?R.dark:R.light,l.lineWidth=1;const e=m.width/2,o=m.height/2,t=(T.offsetX-e)*-.1,s=(T.offsetY-o)*-.1,r=Math.max(-L,Math.min(L,t)),a=Math.max(-L,Math.min(L,s));b.showLines&&B(r,a);let u=1/0,c=-1;for(let f=0;f<d.length;f++){const w=d[f],x=w.x+i+r,z=w.y+i+a,Y=Math.hypot(y.x-x,y.y-z);Y<u&&(u=Y,c=f)}const h=C*.1;for(let f=0;f<d.length;f++){const w=d[f];w.targetRadius=f===c?b.dotSizeHighlight:b.dotSize,w.radius+=(w.targetRadius-w.radius)*h}for(const f of d){const w=f.x+i+r,x=f.y+i+a;l.beginPath(),l.arc(w,x,f.radius,0,Math.PI*2),l.fill()}M=requestAnimationFrame(A)}function q(){if(!m)return;const n=window.innerWidth+i*2,e=window.innerHeight+i*2;m.width=n,m.height=e;const o=new Date().toDateString(),t=E(o),s=G(t);d=I(s,n,e)}function G(n){const e=b.polygonSides;if(e.length===0)return 4;const o=Math.floor(n()*e.length);return e[o]}function P(n){y.x=n.clientX+i,y.y=n.clientY+i}function J(n){b={...b,...n},q()}function K(n){if(m=n,l=m.getContext("2d"),!l)return console.error("DotBackground: 无法获取 Canvas 2D 上下文"),()=>{};X=O(),y={x:window.innerWidth/2+i,y:window.innerHeight/2+i},T={offsetX:y.x,offsetY:y.y};const e=window.innerWidth+i*2,o=window.innerHeight+i*2;m.width=e,m.height=o,m.style.transform=`translate(${-i}px, ${-i}px)`,m.style.zIndex="-1";const t=new Date().toDateString(),s=E(t),r=G(s);d=I(r,e,o),$();const a=j(q,H);return window.addEventListener("resize",a),window.addEventListener("mousemove",P),M=requestAnimationFrame(A),()=>{M!==null&&(cancelAnimationFrame(M),M=null),window.removeEventListener("resize",a),window.removeEventListener("mousemove",P)}}function Q(){k&&(k.disconnect(),k=null),v&&(clearTimeout(v),v=null),m=null,l=null,d=[],y={x:0,y:0},T={offsetX:0,offsetY:0}}export{Q as d,K as i,J as u};
